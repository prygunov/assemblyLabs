.model tiny
.code
org  100h

;????????? ?????? ? ?????? ????
;??????????, ?????????? ?????????? ????????? ? ?????? ????? ?????
;??????? ? ????.
start:
    mov ax,3d02h ; ???????? ????? ??? ! ?????? !
    mov dx,offset file1 ; ???????? ? dx ????? ???????? (lab21.com)
    int 21h; ?????????? ?????? ?????
    xchg ax,bx; ? ax ????? ????????? ????????????? ?????, ?????????? ??? ? bx, ax = 0

    mov ah,3Fh ; ?????? ????
    mov cx,100h ; ????????? 100h ????
    mov dx,pointer ; ?????? ???? - pointer ??? ????? ??? ??????????? ????
    int 21h ; ? ax ?????? ????? ????????? ????

    add pointer,ax ; ?????-?? ? ?????? ?????????? ??? ????? (??????????? ??? ???????)
    mov ax,3d02h ; ??? ??????
    mov dx,offset filename ; ????????? ???? ???????? ?????????
    int 21h ; ? ax ????? ????????? ????????????? ?????

    xchg ax,bx ; ? ???? ????? ? bx ?????? ????????? lab22, lab21 ?????? ? ax
    push bx ; bx ??????? ? ????

    mov ah,3Fh ; ?????? ????, ?????? lab22
    mov cx,1000h; ??????? ????
    mov dx,pointer; ?????? ? pointer
    int 21h; ? ax ??????? ?????????? ??????????? ????

    mov di,pointer; di ?????? ?????
    mov [di-2],ax; ????? ??????? ????? ????? ??????????? ?????
    add pointer,ax; ????? ????????? ? ??????

    xchg ax,cx ; cx - ??????? ?????, ????? ???? ?????????? ??????????? ???? ?? lab22
    mov si,dx
crypt:
    xor byte ptr [si],0AAh; ??????????? ??? ? ?????? 0AAh(170)(10101010)
    inc si
    loop crypt;???? ? ????? crypt CX ???

    ; ????? ????, ??? ????, ?????? ????????? ?? ???????? ?????????, ? ????? ?????? ?????
    ; -------------------------------------------
    mov ax,3d02h
    mov dx,offset file2; ??? ?????? lab23.com
    int 21h ; ? ax ????? ????????? ?????

    xchg ax,bx ;?????????? ??? ? bx, ax = 0
    mov ah,3Fh
    mov cx,100h
    mov dx,pointer
    int 21h
    ;------------------------------------------

    add pointer,ax
    mov ax,4200h ;?????????? ???????? ????????? ?? ?????? ?????
    pop bx ; ??????? ?? ????? ??????? ? bx
    xor cx,cx
    xor dx,dx
    int 21h

    mov ah,40h ; ?????? ? ???? BX = ????????? ?????; DS:DX = ????? ?????? ? ??????????? ??? ??????;CX - ????? ???????????? ????
    mov dx,offset buffer
    mov cx,pointer
    sub cx,dx; ???????? ?? cx dx
    int 21h
ret
    filename db 'lab22.com',0
    file1 db 'lab21.com',0
    file2 db 'lab23.com',0
    pointer dw offset buffer
buffer:

end start